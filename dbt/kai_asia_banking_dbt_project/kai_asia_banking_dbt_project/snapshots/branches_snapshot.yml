snapshots:
  - name: snp_branches
    relation: source('staging', 'stg_branches')
    config:
      schema: snapshots
      database: db_banking
      unique_key: branch_id
      strategy: check
      check_cols: ['branch_name', 'address', 'status']
      hard_deletes: ignore
      dbt_valid_to_current: "'9999-12-31'::date"
      post_hook:  |
        UPDATE {{this}}
        SET status = 'DISABLE'
        WHERE dbt_valid_to != '9999-12-31'::date
          AND status = 'ACTIVE'